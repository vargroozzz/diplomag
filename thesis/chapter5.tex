% --- Chapter 4: Testing and Deployment ---
\chapter{Тестування та розгортання}
\label{ch:testing_deployment}

\section{Тестування системи}
\label{sec:testing}
Тестування є невід'ємною частиною процесу розробки програмного забезпечення, спрямованою на виявлення помилок та забезпечення відповідності функціональним та нефункціональним вимогам. Для веб-платформи для комунікації та обміну знаннями в спільноті бджолярів \textit{Beekeepers Community Platform} було проведено кілька видів тестування.

\subsection{Модульне тестування (Unit Testing)}
Модульне тестування було зосереджено на перевірці окремих компонентів та функцій серверної частини (NestJS \cite{nestjs}). Використовувався вбудований в NestJS тестовий фреймворк, що базується на Jest \cite{jestjs}. Тестувалися сервіси, контролери (частково) та допоміжні утиліти. Основна увага приділялася тестуванню бізнес-логіки в сервісах, валідації даних та коректності відповідей API.
% TODO: Provide examples of unit tests if relevant or link to appendix.

\subsection{Інтеграційне тестування}
Інтеграційне тестування передбачало перевірку взаємодії між різними модулями системи, зокрема між фронтендом та бекендом (API ендпоінти), а також взаємодію бекенду з базою даних MongoDB. На цьому етапі перевірялася коректність обробки запитів, передачі даних та їх збереження/отримання.

\subsection{Тестування користувацького інтерфейсу (UI Testing)}
На фронтенді проводилося ручне тестування користувацького інтерфейсу на різних пристроях та в різних браузерах (Chrome, Firefox, Safari) для забезпечення адаптивності та коректного відображення. Перевірялася робота інтерактивних елементів, форм, навігації та картографічного функціоналу.
% TODO: Mention tools if any were used for automated UI testing (e.g., Cypress, Playwright - even if just planned).

\subsection{Тестування безпеки}
Здійснювалася базова перевірка на поширені веб-вразливості, такі як XSS (здебільшого покривається React), валідація вхідних даних для запобігання ін'єкціям на рівні API. Також перевірялася робота системи автентифікації та авторизації, зокрема захист маршрутів та валідність JWT токенів.

\section{Розгортання застосунку}
\label{sec:deployment}
Для розгортання веб-платформи для комунікації та обміну знаннями в спільноті бджолярів \textit{Beekeepers Community Platform} було обрано платформу як сервіс (Platform as a Service, PaaS) Render \cite{renderpaas}, що дозволило автоматизувати та спростити процес виведення застосунку в продуктивне середовище. Контейнеризація за допомогою Docker \cite{docker} та Docker Compose, описана на етапі локальної розробки, лягла в основу конфігурації сервісів на Render.

\subsection{Конфігурація сервісів на Render}
Платформа була розділена на два основні сервіси, розгорнуті на Render:
\begin{itemize}
    \item \textbf{Клієнтська частина (Frontend):} Розгорнута як "Static Site". Render було підключено до GitHub репозиторію проекту. При кожному оновленні основної гілки (наприклад, \texttt{main} або \texttt{master}) Render автоматично ініціював процес збірки, виконуючи команду \texttt{npm run build} (визначену у \texttt{package.json} Vite-проекту). Зібрані статичні активи з директорії \texttt{client/dist} публікувалися та ставали доступними через наданий Render домен. Налаштування Render для статичних сайтів також дозволило легко конфігурувати правила перенаправлення для коректної роботи односторінкового застосунку (SPA) з React Router.
    \item \textbf{Серверна частина (Backend):} Розгорнута як "Web Service" з використанням Docker-контейнера. Файл \texttt{Dockerfile}, що знаходився в директорії \texttt{server/}, використовувався Render для побудови образу. Цей Dockerfile був оптимізований для продуктивного середовища, потенційно включаючи багатоетапну збірку для зменшення розміру кінцевого образу. Командою запуску сервісу була вказана \texttt{npm run start:prod}. Render автоматично обробляв мапінг портів, роблячи внутрішній порт NestJS-застосунку (наприклад, 4000) доступним для зовнішнього трафіку.
    \item \textbf{База даних:} Для зберігання даних використовувалася хмарна служба MongoDB Atlas \cite{mongodb}. Було створено безкоштовний кластер, отримано рядок підключення (SRV-запис), який потім був безпечно доданий як змінна середовища як \texttt{DATABASE\_URL} (уніфікований локатор ресурсів – Uniform Resource Locator) в налаштуваннях бекенд-сервісу на Render. Налаштування мережевого доступу в MongoDB Atlas було сконфігуровано для дозволу з'єднань з IP-адрес (адрес інтернет-протоколу – Internet Protocol) сервісів Render, або використовувалися загальнодоступні IP (0.0.0.0/0) на час розробки з подальшим посиленням безпеки.
\end{itemize}

\subsection{Управління конфігурацією, безпека та CI/CD}
Ключові аспекти конфігурації, безпеки та автоматизації при розгортанні на Render включали:
\begin{itemize}
    \item \textbf{Змінні середовища:} Усі чутливі дані – секрети JWT, ключі API для сервісу Mailgun, URL бази даних MongoDB Atlas, порт сервера, тощо – були конфігуровані виключно через змінні середовища в панелі керування Render для кожного сервісу. Це забезпечує надійний захист конфігураційної інформації та унеможливлює її потрапляння до системи контролю версій.
    \item \textbf{HTTPS:} Render автоматично надає та управляє сертифікатами SSL (Secure Sockets Layer – рівень захищених сокетів) (через Let's Encrypt) для всіх веб-сервісів та статичних сайтів, розгорнутих на платформі. Це забезпечило шифрування всього трафіку між клієнтами та серверами за захищеним протоколом передачі гіпертексту (HTTPS) без необхідності ручного налаштування сертифікатів.
    \item \textbf{Автоматичне розгортання (CI/CD з Render):} Інтеграція Render з GitHub репозиторієм забезпечила базовий, але ефективний процес безперервної інтеграції та доставки. Кожен push або merge в основну гілку (наприклад, \texttt{main} або \texttt{master}) автоматично ініціював нову збірку та розгортання відповідного сервісу (фронтенд чи бекенд) на Render, що значно прискорило ітераційний процес розробки та оновлення застосунку.
    \item \textbf{Автоматизовані перевірки якості коду (GitHub Actions):} Для забезпечення високої якості коду та раннього виявлення потенційних проблем було налаштовано робочий процес GitHub Actions (файл \texttt{.github/workflows/lint-pr.yml}). Цей процес автоматично запускається при створенні або оновленні кожного запиту на злиття (Pull Request) до основних гілок репозиторію (наприклад, \texttt{master}). Робочий процес включає наступні кроки: вивантаження коду, налаштування середовища Node.js (версія 22.x), встановлення залежностей для клієнтської та серверної частин за допомогою \texttt{npm ci}, та запуск команди \texttt{make lint\_ci}. Команда \texttt{make lint\_ci}, визначена у файлі \texttt{Makefile}, послідовно виконує скрипти лінтингу (ESLint з відповідними конфігураціями) для обох частин проекту, причому для серверної частини використовується прапорець \texttt{--max-warnings 0} для забезпечення неуспішного завершення при наявності будь-яких попереджень. Успішне проходження цього CI-завдання є однією з умов для злиття змін, що сприяє підтримці чистоти та консистентності кодової бази.
    \item \textbf{Моніторинг та Логування:} Render надає вбудовані інструменти для перегляду логів розгорнутих сервісів в реальному часі, що використовувалося для моніторингу стану застосунку та діагностики можливих проблем під час роботи.
\end{itemize}

Використання PaaS-платформи Render значно спростило інфраструктурні аспекти розгортання, дозволивши зосередитися на розробці самого застосунку. Перевагами такого підходу стали легкість налаштування, глибока інтеграція з Git, автоматичне масштабування (в межах можливостей обраного тарифного плану Render), забезпечення безпечного HTTPS-з'єднання, та зручне управління змінними середовища. Це дозволило швидко отримати робочий прототип, доступний онлайн.

% Для продакшн-розгортання рекомендується використання оберненого проксі-сервера (наприклад, Nginx) для обслуговування статичних файлів фронтенду, кешування, балансування навантаження (за потреби) та налаштування HTTPS. % This sentence might now be less relevant if Render handles much of it, but can be kept if Nginx was used IN Render or as a general best practice note.

\section{Майбутні напрямки розвитку}
\label{sec:future_work}
Веб-платформа для комунікації та обміну знаннями в спільноті бджолярів \textit{Beekeepers Community Platform} має потенціал для подальшого розвитку та розширення функціоналу. Можливі напрямки включають:
\begin{itemize}
    \item Розширення функціоналу бази знань: додавання можливості користувачам пропонувати статті, система рецензування, коментарі.
    \item Розвиток картографічного сервісу: фільтри за типами культур, періодами цвітіння, сповіщення про обробку полів, інтеграція з погодними даними.
    \item Система приватних повідомлень між користувачами.
    \item Календар подій для бджолярів (виставки, ярмарки, семінари).
    \item \textbf{Вдосконалення та повна інтеграція інтелектуального FAQ-асистента:}
        \begin{itemize}
            \item Заміна статичного масиву ЧаПи (\texttt{FAQ\_DATA}) на динамічне завантаження даних з модуля "База знань" або окремої колекції в MongoDB, що дозволить адміністраторам легко оновлювати та розширювати контент для асистента.
            \item Впровадження механізму семантичного пошуку (наприклад, з використанням векторних вкладень тексту та векторної бази даних) для відбору найбільш релевантних фрагментів з бази знань для формування контексту для LLM. Це дозволить значно підвищити точність відповідей та подолати обмеження на максимальну довжину промпту при великих обсягах інформації.
            \item Додавання можливості для користувачів оцінювати корисність відповідей асистента (наприклад, лайк/дизлайк) для збору зворотного зв'язку та подальшого покращення якості.
            \item Розгляд можливості тонкого налаштування (fine-tuning) меншої, можливо відкритої, мовної моделі на специфічних даних платформи для оптимізації витрат та підвищення контролю над відповідями.
            \item Інтеграція механізму кешування для часто задаваних питань для зменшення кількості запитів до OpenAI API та прискорення отримання відповідей.
            \item Моніторинг використання та аналіз запитів до FAQ-асистента для виявлення прогалин у базі знань та оптимізації роботи сервісу.
        \end{itemize}
    \item Мобільний застосунок (React Native або нативні технології).
    \item Розширена аналітика та статистика для користувачів (наприклад, продуктивність пасік).
    \item Інтеграція з іншими сервісами (наприклад, маркетплейси для продукції бджільництва).
\end{itemize} 